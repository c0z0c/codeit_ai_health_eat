---
layout: default
title: "경구약제 이미지 분류를 위한 EDA 및 전처리 보고서"
description: "코드잇 AI 4기 4팀 - 딥러닝 기반 약품식별 AI 개발을 위한 데이터 탐색적 분석 및 전처리 보고서"
date: 2025-09-11
author: "김명환"
team: "코드잇 AI 4기 4팀"
cache-control: no-cache
expires: 0
pragma: no-cache
---

# 경구약제 이미지 분류를 위한 EDA 및 전처리 보고서

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)<br/>
   1.1. [프로젝트 목적](#11-프로젝트-목적)<br/>
   1.2. [데이터셋 정보](#12-데이터셋-정보)<br/>
   1.3. [기술적 목표](#13-기술적-목표)<br/>

2. [데이터셋 탐색적 분석 (EDA)](#2-데이터셋-탐색적-분석-eda)<br/>
   2.1. [데이터 구조 분석](#21-데이터-구조-분석)<br/>
   2.2. [클래스 분포 분석](#22-클래스-분포-분석)<br/>
   2.3. [이미지 특성 분석](#23-이미지-특성-분석)<br/>
   2.4. [라벨링 품질 분석](#24-라벨링-품질-분석)<br/>

3. [데이터 전처리](#3-데이터-전처리)<br/>
   3.1. [전처리 전략](#31-전처리-전략)<br/>
   3.2. [배경 제거 및 노이즈 처리](#32-배경-제거-및-노이즈-처리)<br/>
   3.3. [YOLO 데이터셋 변환](#33-yolo-데이터셋-변환)<br/>
   3.4. [이미지 정규화](#34-이미지-정규화)<br/>

4. [데이터셋 구성](#4-데이터셋-구성)<br/>
   4.1. [훈련용 데이터셋](#41-훈련용-데이터셋)<br/>
   4.2. [검증용 데이터셋](#42-검증용-데이터셋)<br/>
   4.3. [테스트용 데이터셋](#43-테스트용-데이터셋)<br/>

5. [결과 및 인사이트](#5-결과-및-인사이트)<br/>
   5.1. [전처리 효과 분석](#51-전처리-효과-분석)<br/>
   5.2. [데이터 품질 개선](#52-데이터-품질-개선)<br/>
   5.3. [향후 모델링 전략](#53-향후-모델링-전략)<br/>

6. [용어집](#6-용어집)<br/>

---

## 1. 프로젝트 개요

### 1.1. 프로젝트 목적

본 프로젝트는 **약품식별 인공지능 모델 개발**을 위한 경구약제 이미지 데이터의 탐색적 분석(Exploratory Data Analysis, EDA) 및 전처리를 수행한다. 목표는 5,000종의 경구약제에 대해 높은 정확도로 식별할 수 있는 딥러닝 모델의 기반을 마련하는 것이다.

### 1.2. 데이터셋 정보

**데이터셋 명**: 약품식별 인공지능 개발을 위한 경구약제 이미지데이터  
**제공기관**: 서울특별시 보라매병원  
**구축년도**: 2021년  
**총 데이터량**: 2,793,978장

#### 1.2.1. 데이터 구성

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/1.2.1.%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B5%AC%EC%84%B1.png" width="640px"/>

#### 1.2.2. 이미지 메타데이터 스키마(Schema)

각 이미지는 다음과 같은 메타정보를 포함한다:

- **이미지 기본정보**: 해상도(Resolution), 파일명, 크기
- **촬영 조건**: 배경색상, 조명색상, 카메라 각도
- **약제 정보**: 제품코드, 제품명, 성분명, 제조사
- **바운딩 박스**: COCO 포맷(Format) 어노테이션(Annotation)

### 1.3. 기술적 목표

1. **객체 검출 모델**: YOLO 아키텍처(Architecture) 기반 다중 객체 검출
2. **분류 정확도**: 5,000종 경구약제 95% 이상 식별률 달성
3. **실시간 처리**: 모바일 환경에서 실시간 약제 식별 가능

---

## 2. 데이터셋 탐색적 분석 (EDA)

### 2.1. 데이터 구조 분석

#### 2.1.1. 파일 구조

데이터셋은 다음과 같은 계층구조(Hierarchical Structure)를 가진다:

```
dataset/
├── images/
│   ├── train/
│   ├── val/
│   └── test/
└── annotations/
    ├── train.json
    ├── val.json
    └── test.json
```

#### 2.1.2. 어노테이션 포맷

각 이미지에 대해 **JSON 형태의 라벨링 파일**이 존재하며, COCO 데이터셋 포맷을 따른다:

- **images**: 이미지 메타데이터
- **annotations**: 바운딩 박스 좌표 및 클래스 정보  
- **categories**: 약제 카테고리 정의

#### 2.1.3. 다중 객체 특성

**핵심 발견사항**: 단일 이미지에 **최대 4개의 알약 객체**가 존재하나, **일부 객체는 라벨링이 누락**된 상태

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/2.1.3.%EB%8B%A4%EC%A4%91%EA%B0%9D%EC%B2%B4%ED%8A%B9%EC%84%B1.png" width="640px"/>

### 2.2. 클래스 분포 분석

#### 2.2.1. 약제 유형별 분포

| 약제 유형 | 종 수 | 비율 | 특징 |
|----------|--------|--------|--------|
| 전문의약품 | 3,143종 | 62.8% | 의사 처방 필요 |
| 일반의약품 | 1,857종 | 37.2% | 일반 구매 가능 |

#### 2.2.2. 형태별 분류

경구약제는 다음과 같은 형태로 구분된다:

- **정제(Tablet)**: 압축 성형된 고체 약제
- **경질 캡슐**: 단단한 젤라틴(Gelatin) 캡슐
- **연질 캡슐**: 부드러운 젤라틴 캡슐

### 2.3. 이미지 특성 분석

#### 2.3.1. 해상도 분포

- **평균 해상도**: 1280×976 픽셀
- **종횡비(Aspect Ratio)**: 주로 4:3 비율
- **파일 크기**: 평균 200KB (PNG 포맷)

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/org_label_%EB%8B%A4%EC%96%91%ED%95%9C%EC%9D%B4%EB%AF%B8%EC%A7%80.png" width="640px"/>


#### 2.3.2. 촬영 조건 다양성

**배경색상 변화**: 흰색, 회색, 검은색 등 다양한 배경  
**조명 조건**: 자연광, 형광등, LED 등  
**촬영 각도**: 0°, 90°, 180°, 270° 회전

#### 2.3.3. 품질 이슈 식별

1. **가장자리 흰색 노이즈**: 촬영 환경으로 인한 경계 노이즈 발생
2. **불균등한 조명**: 일부 이미지에서 그림자 및 반사 현상
3. **라벨링 불일치**: 시각적으로 존재하나 어노테이션되지 않은 객체

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/org_label_K-002483-003743-005886-012778_0_2_0_2_75_000_200.png" width="640px"/>

---

## 3. 데이터 전처리

### 3.1. 전처리 전략

데이터 품질 향상을 위해 다음과 같은 **2단계 전처리 파이프라인(Pipeline)**을 설계하였다:

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/3.1.%EC%A0%84%EC%B2%98%EB%A6%AC%EC%A0%84%EB%9E%B5.png" width="640px"/>

### 3.2. 배경 제거 및 노이즈 처리

#### 3.2.1. 배경 재구성 알고리즘

**핵심 아이디어**: 라벨링된 바운딩 박스를 마스크(Mask)로 활용하여 배경을 분리하고, 배경 영역의 평균값으로 새로운 배경을 생성

```python
# 의사코드 (Pseudocode)
def reconstruct_background(image, bbox_list):
    mask = create_mask_from_bbox(bbox_list)
    background_pixels = image[~mask]
    background_mean = np.mean(background_pixels, axis=0)
    
    new_image = image.copy()
    new_image[~mask] = background_mean
    
    return new_image
```

#### 3.2.2. 노이즈 제거 효과

1. **가장자리 흰색 노이즈 제거**: 촬영 시 발생한 경계 노이즈 완전 제거
2. **라벨링되지 않은 객체 제거**: 관심 대상이 아닌 약제 객체 자동 제거
3. **배경 일관성 확보**: 모든 이미지의 배경을 통일된 색상으로 표준화

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/nolabel_label_K-002483-003743-005886-012778_0_2_0_2_75_000_200.png" width="640px"/>


### 3.3. YOLO 데이터셋 변환

#### 3.3.1. 이미지 정규화

**목표 해상도**: 640×640 픽셀 (YOLO 표준)  
**변환 방법**: 비율 유지 리사이즈 + 패딩(Padding)

#### 3.3.2. 바운딩 박스 좌표 변환

COCO 포맷에서 YOLO 포맷으로 변환:

**COCO 포맷**: `[x_min, y_min, width, height]` (절대좌표)  
**YOLO 포맷**: `[x_center, y_center, width, height]` (상대좌표, 0-1 정규화)

$$
\begin{align}
x_{center} &= \frac{x_{min} + width/2}{image_{width}} \\
y_{center} &= \frac{y_{min} + height/2}{image_{height}} \\
w_{norm} &= \frac{width}{image_{width}} \\
h_{norm} &= \frac{height}{image_{height}}
\end{align}
$$

### 3.4. 이미지 정규화

#### 3.4.1. 정규화 전략 비교

모델링 실험을 위해 **2가지 정규화 방법**을 적용한 데이터셋을 구성:

| 방법 | 평균값 | 표준편차 | 적용 대상 |
|------|--------|----------|----------|
| **ImageNet 정규화** | [0.485, 0.456, 0.406] | [0.229, 0.224, 0.225] | 사전훈련 모델 활용 시 |
| **단순 리사이즈** | 별도 정규화 없음 | 별도 정규화 없음 | 비교 실험용 |

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/resize_K-002483-003743-005886-012778_0_2_0_2_75_000_200.png" width="640px"/>

#### 3.4.2. 테스트 데이터 처리

**테스트 이미지 특징**: 라벨링 정보 없음  
**적용 방법**: ImageNet 평균값을 활용한 표준 정규화
**단순 리사이즈**: 640 x 640

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/1.png" width="640px"/>

---

## 4. 데이터셋 구성

### 4.1. 훈련용 데이터셋

**구성 비율**: 전체 데이터의 70%  
**전처리 적용**: 배경 재구성 + YOLO 변환 + ImageNet 정규화  
**데이터 증강(Data Augmentation)**: 회전, 밝기 조절, 노이즈 추가

### 4.2. 검증용 데이터셋

**구성 비율**: 전체 데이터의 20%  
**용도**: 하이퍼파라미터(Hyperparameter) 튜닝 및 모델 선택  
**전처리**: 훈련 데이터와 동일

### 4.3. 테스트용 데이터셋

**구성 비율**: 전체 데이터의 10%  
**특징**: 실제 서비스 환경과 유사한 조건  
**전처리**: ImageNet 정규화만 적용
**단순 리사이즈**: 640 x 640

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/org_train_val_test_%EB%B6%84%ED%8F%AC%EB%8F%84.png
" width="640px"/>

---

## 5. 결과 및 인사이트

### 5.1. 전처리 효과 분석

#### 5.1.1. 데이터 품질 개선 효과

**좌표계 정규화 성과**:
- **이상값 처리**: YOLO 좌표 범위 초과 문제 해결 (6.89 → 1.0으로 클리핑)
- **배경 일관성**: 다양한 배경을 통일된 평균값으로 표준화
- **객체 분리**: 관심 대상 약제만 명확히 분리

#### 5.1.2. 경진대회 데이터 특성 분석

**클래스 균형성**:
```
73개 클래스 모두 Train/Validation에 포함
평균 클래스당 바운딩박스: 61.4개 (4526/73)
클래스 ID 분포: 균등 분포 (표준편차 21.22)
```

**다중 객체 처리**:
- **이미지당 평균 객체 수**: 2.3개 (5369 bbox / 2332 images)
- **복합 파일명 구조**: 최대 4개 약제 코드 조합 지원
- **라벨링 완성도**: 편집 과정에서 누락 객체 제거 완료

<img src="https://c0z0c.github.io/codeit_ai_health_eat/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C/EDA_%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%A0%84%EC%B2%98%EB%A6%AC/org_train_%ED%81%B4%EB%9E%98%EC%8A%A4%EB%B6%84%ED%8F%AC%EB%8F%84.png" width="640px"/>

### 5.2. 데이터 품질 개선

#### 5.2.1. 경진대회 최적화

**원본 대비 개선사항**:
- **클래스 수 축소**: 5,000종 → 73종 (관리 가능한 규모)
- **품질 검증**: 라벨링 품질이 검증된 데이터만 선별
- **표준화**: 모든 이미지 976×1280 픽셀로 통일

#### 5.2.2. YOLO 최적화

**기대 성능 향상**:
- **mAP@0.5**: 0.85+ 목표 (73클래스 최적화로 인한 복잡도 감소)
- **추론 속도**: 640×640 표준화로 실시간 처리 가능
- **메모리 효율성**: 클래스 수 축소로 모델 크기 최적화

### 5.3. 향후 모델링 전략

#### 5.3.1. 아키텍처 선택

**1차 후보**: YOLOv8n (경량화 모델)  
**2차 후보**: YOLOv8s (정확도 중심)  
**최종 목표**: 모바일 환경 최적화

#### 5.3.2. 전이학습(Transfer Learning) 전략

**사전훈련 모델**: COCO 데이터셋으로 훈련된 YOLOv8  
**파인튜닝(Fine-tuning)**: 경구약제 특성에 맞는 가중치 조정  
**점진적 학습**: 쉬운 클래스부터 어려운 클래스 순서로 학습

#### 5.3.3. 평가 지표

**주요 지표**:
- **mAP@0.5**: 다중 객체 검출 정확도
- **Top-1 Accuracy**: 단일 약제 분류 정확도  
- **추론 시간**: 실시간 처리 가능성

---

## 6. 용어집

| 용어 | 정의 |
|------|------|
| **경구약제** | 입으로 복용하는 형태의 의약품 (정제, 캡슐 등) |
| **바운딩 박스** | 객체의 위치를 나타내는 직사각형 좌표 |
| **어노테이션** | 이미지에서 객체의 위치와 클래스를 표시한 라벨링 정보 |
| **COCO 포맷** | 컴퓨터 비전에서 널리 사용되는 데이터셋 어노테이션 형식 |
| **YOLO** | You Only Look Once - 실시간 객체 검출 알고리즘 |
| **mAP** | mean Average Precision - 객체 검출 모델의 성능 지표 |
| **전이학습** | 기존 모델의 지식을 새로운 작업에 활용하는 학습 방법 |
| **데이터 증강** | 기존 데이터를 변형하여 훈련 데이터의 다양성을 증가시키는 기법 |
| **ImageNet** | 대규모 이미지 데이터셋, 사전훈련 모델의 표준 |
| **하이퍼파라미터** | 모델 학습 과정에서 설정하는 매개변수 |
| **파인튜닝** | 사전훈련된 모델을 특정 작업에 맞게 세부 조정하는 과정 |
| **추론** | 훈련된 모델을 사용하여 새로운 데이터에 대한 예측을 수행하는 과정 |